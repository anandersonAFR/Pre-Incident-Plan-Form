<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AFRD Pre-Incident Plan Submission</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2; /* light grey page background */
    }
    .container {
      max-width: 600px;
      background: #ffffff;
      padding: 20px;
      margin: 20px auto;
      border-radius: 4px;
    }
    /* Header image styling */
    .header-img {
      width: 100%;
      max-width: 100%;
      height: auto;
      display: block;
      margin-bottom: 15px;
    }
    h2 {
      text-align: center;
      color: #B31B1B; /* AFRD red */
      margin-top: 0;
    }
    p.notice {
      text-align: center;
      font-size: 0.9em;
      color: #333;
    }
    label {
      display: block;
      font-weight: bold;
      margin: 8px 0 4px;
    }
    input[type=text],
    input[type=date],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    input[type=date]:read-only {
      color: #555;
      /* Prevent user editing date if read-only (some browsers) */
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    input[readonly], textarea[readonly] {
      background-color: #f9f9f9;
    }
    select:required:invalid {
      color: #777;
    }
    option[value=""] {
      color: #999;
    }
    .btn-submit {
      background: #B31B1B; /* red background for submit */
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      padding: 10px 15px;
      font-size: 1em;
      cursor: pointer;
      width: 100%;
      margin: 15px 0;
    }
    .btn-submit:hover {
      background: #8A1414; /* darker red on hover */
    }
    .status-message {
      display: none;
      font-size: 1.1em;
      text-align: center;
      margin-top: 20px;
    }
    .status-success {
      color: green;
    }
    .status-error {
      color: red;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Header section with image and title -->
  <img src="A_digital_composite_image_for_the_Atlanta_Fire_Res.png" alt="AFRD Firefighter" class="header-img" />
  <h2>Pre-Incident Plan Submission</h2>
  <p class="notice"><em>Fields marked with * are required.</em></p>
  
  <!-- Form start -->
  <form id="pipForm">
    <!-- Address -->
    <label for="address">Address *:</label>
    <input type="text" id="address" name="address" required />
    
    <!-- Building Name -->
    <label for="buildingName">Building Name *:</label>
    <input type="text" id="buildingName" name="buildingName" required />
    
    <!-- Building Representative -->
    <label for="buildingRep">Building Representative *:</label>
    <input type="text" id="buildingRep" name="buildingRep" required />
    
    <!-- Hydrant -->
    <label for="hydrant">Hydrant on Site *:</label>
    <select id="hydrant" name="hydrant" required>
      <option value="" disabled selected>Select one</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
      <option value="Unknown">Unknown</option>
    </select>
    
    <!-- Building Size -->
    <label for="buildingSize">Building Size *:</label>
    <input type="text" id="buildingSize" name="buildingSize" required />
    
    <!-- Occupancy Type -->
    <label for="occupancy">Occupancy Type *:</label>
    <select id="occupancy" name="occupancy" required>
      <option value="" disabled selected>Select one</option>
      <option value="Residential">Residential</option>
      <option value="Commercial">Commercial</option>
      <option value="Mixed-Use">Mixed-Use</option>
      <option value="Industrial">Industrial</option>
      <option value="Vacant">Vacant</option>
    </select>
    
    <!-- Fire Protection System -->
    <label for="fireProt">Fire Protection System *:</label>
    <select id="fireProt" name="fireProt" required>
      <option value="" disabled selected>Select one</option>
      <option value="Sprinkler">Sprinkler</option>
      <option value="Standpipe">Standpipe</option>
      <option value="Both">Both</option>
      <option value="None">None</option>
      <option value="Unknown">Unknown</option>
    </select>
    
    <!-- Fire Protection System Location -->
    <label for="fireProtLocation">Fire Prot. System Location:</label>
    <input type="text" id="fireProtLocation" name="fireProtLocation" placeholder="e.g. Riser room, Basement, N/A" />
    
    <!-- Alarm Panel Location -->
    <label for="alarmPanel">Alarm Panel Location:</label>
    <input type="text" id="alarmPanel" name="alarmPanel" placeholder="e.g. Lobby, N/A" />
    
    <!-- Utilities -->
    <label for="utilities">Utilities *:</label>
    <input type="text" id="utilities" name="utilities" placeholder="e.g. Gas and electrical shutoff locations" required />
    
    <!-- Knox Box -->
    <label for="knoxBox">Knox Box *:</label>
    <select id="knoxBox" name="knoxBox" required>
      <option value="" disabled selected>Select one</option>
      <option value="Present">Present</option>
      <option value="Missing">Missing</option>
      <option value="Unknown">Unknown</option>
    </select>
    
    <!-- Hazmat -->
    <label for="hazmat">Hazmat *:</label>
    <select id="hazmat" name="hazmat" required>
      <option value="" disabled selected>Select one</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
      <option value="Unknown">Unknown</option>
    </select>
    
    <!-- Additional Info -->
    <label for="additionalInfo">Additional Info (Optional):</label>
    <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Any other important information..."></textarea>
    
    <!-- Date (auto-filled) -->
    <label for="date">Date *:</label>
    <input type="date" id="date" name="date" required readonly />
    
    <!-- GPS Location (auto-filled, optional) -->
    <label for="gps">GPS Location (Optional):</label>
    <input type="text" id="gps" name="gps" readonly placeholder="Latitude, Longitude" />
    
    <!-- Building Photos (file upload, optional) -->
    <label for="photos">Building Photos (Optional):</label>
    <input type="file" id="photos" name="photos" accept="image/*" multiple />
    
    <!-- Submit Button -->
    <button type="submit" class="btn-submit">Submit</button>
  </form>
  
  <!-- Status message area -->
  <div id="statusMessage" class="status-message"></div>
</div>

<!-- Partial: Updated JavaScript Section with Logging and Image Upload Disabled -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const yyyy = today.getFullYear();
    let mm = String(today.getMonth() + 1).padStart(2, '0');
    let dd = String(today.getDate()).padStart(2, '0');
    const dateStr = yyyy + '-' + mm + '-' + dd;
    document.getElementById('date').value = dateStr;

    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude.toFixed(6);
        const lon = position.coords.longitude.toFixed(6);
        document.getElementById('gps').value = lat + ', ' + lon;
      });
    }
  });

  document.getElementById('pipForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const statusEl = document.getElementById('statusMessage');
    statusEl.className = 'status-message';
    statusEl.textContent = '';

    const fields = {
      "Address": document.getElementById('address').value,
      "Building Name": document.getElementById('buildingName').value,
      "Building Representative": document.getElementById('buildingRep').value,
      "Hydrant": document.getElementById('hydrant').value,
      "Building Size": document.getElementById('buildingSize').value,
      "Occupancy Type": document.getElementById('occupancy').value,
      "Fire Protection System": document.getElementById('fireProt').value,
      "Fire Protection System Location": document.getElementById('fireProtLocation').value,
      "Alarm Panel Location": document.getElementById('alarmPanel').value,
      "Utilities": document.getElementById('utilities').value,
      "Knox Box": document.getElementById('knoxBox').value,
      "Hazmat": document.getElementById('hazmat').value,
      "Additional Info": document.getElementById('additionalInfo').value,
      "Date": document.getElementById('date').value,
      "GPS Location": document.getElementById('gps').value
    };

    console.log("Submitting data:", JSON.stringify({ fields: fields }));

    const airtableEndpoint = "https://api.airtable.com/v0/appoFp9XDO22Wyi9g/PIP";
    const airtableToken = "patKJcYQeZebXXB9p.4088f1221a2c9fc1d710d65b2ba113937b918464cae0d470f10d2101e3582dca";

    const reqOptions = {
      method: "POST",
      headers: {
        "Authorization": "Bearer " + airtableToken,
        "Content-Type": "application/json",
        "Prefer": "return=representation"
      },
      body: JSON.stringify({ fields: fields })
    };

    fetch(airtableEndpoint, reqOptions)
      .then(response => {
        if (!response.ok) {
          throw new Error("Error creating record: " + response.statusText);
        }
        return response.json();
      })
      .then(data => {
        /*
        const recordId = data.id;
        const fileInput = document.getElementById('photos');
        if (fileInput.files && fileInput.files.length > 0) {
          // Image upload logic (temporarily disabled)
        }
        */
        return "success";
      })
      .then(result => {
        document.getElementById('pipForm').reset();
        document.getElementById('pipForm').style.display = "none";
        statusEl.textContent = "âœ… Thank you! Your pre-incident plan has been submitted successfully.";
        statusEl.classList.add('status-success');
        statusEl.style.display = "block";
      })
      .catch(error => {
        console.error(error);
        statusEl.textContent = "Submission failed. Please try again.";
        statusEl.classList.add('status-error');
        statusEl.style.display = "block";
      });
  });
</script>

</body>
</html>